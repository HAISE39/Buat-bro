-- =====================================
-- ‚ö° Unlimited Skill / No Cooldown ‚ö°
-- Support: ARM32 & ARM64
-- With Safety Checks
-- =====================================

if not gg then os.exit() end
gg.setVisible(false)

-- Cari libil2cpp.so
local ranges = gg.getRangesList("libil2cpp.so")
if #ranges == 0 then
  gg.alert("‚ùå libil2cpp.so tidak ditemukan!\nGame mungkin tidak support / nama library berbeda.")
  os.exit()
end

local base = ranges[1].start

-- Offset dari dump.cs
local offset_get_connect_cd = 0x2B6D7E0
local offset_get_skill_cd   = 0x2BFEEA4
local offset_is_accel_cd    = 0x2975584
local offset_get_cd_prop    = 0x2EE0914

-- Hitung alamat absolut
local addr_connect_cd = base + offset_get_connect_cd
local addr_skill_cd   = base + offset_get_skill_cd
local addr_is_accel   = base + offset_is_accel_cd
local addr_cd_prop    = base + offset_get_cd_prop

-- Patch bytes
local patch_thumb = "70 47"       -- ARM32 Thumb (BX LR)
local patch_arm64 = "C0 03 5F D6" -- ARM64 (RET)

-- Deteksi arsitektur
local isArm64 = gg.getTargetInfo().x64
local patch_bytes = isArm64 and patch_arm64 or patch_thumb

-- Patch data
local patches = {
  {address = addr_connect_cd, flags = gg.TYPE_BYTE, value = patch_bytes},
  {address = addr_skill_cd,   flags = gg.TYPE_BYTE, value = patch_bytes},
  {address = addr_is_accel,   flags = gg.TYPE_BYTE, value = patch_bytes},
  {address = addr_cd_prop,    flags = gg.TYPE_BYTE, value = patch_bytes},
}

-- Simpan instruksi asli untuk restore (safety try)
local status, original = pcall(function() return gg.getValues(patches) end)
if not status then
  gg.alert("‚ùå Gagal membaca offset! Versi game berbeda atau offset salah.")
  os.exit()
end

-- Fungsi aktifkan cheat
function enableNoCooldown()
  gg.setValues(patches)
  gg.toast("‚úÖ Unlimited Skill / No Cooldown Aktif (" .. (isArm64 and "ARM64" or "ARM32") .. ")")
end

-- Fungsi matikan cheat
function disableNoCooldown()
  gg.setValues(original)
  gg.toast("üîÑ Unlimited Skill / No Cooldown Dimatikan")
end

-- Loop menu
while true do
  if gg.isVisible(true) then
    gg.setVisible(false)
    local menu = gg.choice({
      "‚ö° Aktifkan Unlimited Skill",
      "‚ùå Matikan Unlimited Skill",
      "üö™ Keluar Script"
    }, nil, "üî• No Skill Cooldown Menu")

    if menu == 1 then
      enableNoCooldown()
    elseif menu == 2 then
      disableNoCooldown()
    elseif menu == 3 then
      gg.toast("üëã Keluar script")
      os.exit()
    end
  end
  gg.sleep(200)
end
